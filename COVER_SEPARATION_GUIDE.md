 # 封面页分离功能使用指南

## 🎯 功能概述

封面页分离功能允许用户分别设计封面和正文模板，系统会自动识别并合并生成最终报告。

## 📋 模板类型

### 1. 封面模板 (cover_template.docx)
- **用途**: 仅包含封面信息
- **必需字段**: `{{name}}`, `{{student_id}}`, `{{project_name}}`
- **可选字段**: `{{class_name}}`, `{{instructor}}`
- **特点**: 不包含 `{{report_body}}` 占位符

### 2. 正文模板 (body_template.docx)
- **用途**: 包含报告正文内容
- **必需字段**: `{{report_body}}`
- **可选字段**: 其他基本信息字段
- **特点**: 包含 `{{report_body}}` 占位符

### 3. 组合模板 (combined_template.docx)
- **用途**: 兼容旧版本的单文件模板
- **特点**: 同时包含封面字段和正文占位符

## 🔍 模板识别规则

系统会自动识别上传的模板文件类型：

1. **封面模板识别**:
   - 包含 `{{name}}`, `{{student_id}}`, `{{project_name}}`
   - **不包含** `{{report_body}}`

2. **正文模板识别**:
   - 包含 `{{report_body}}` 占位符

3. **组合模板识别**:
   - 同时包含封面字段和 `{{report_body}}`
   - 会被识别为正文模板

## 🚀 使用方法

### 方法一：分离模式（推荐）
1. 上传封面模板文件
2. 上传正文模板文件
3. 上传资料文件
4. 填写基本信息
5. 生成报告

### 方法二：单文件模式
1. 上传一个包含所有字段的模板文件
2. 上传资料文件
3. 填写基本信息
4. 生成报告

## 📁 文件结构示例

```
uploads/
├── cover_template.docx     # 封面模板
├── body_template.docx      # 正文模板
├── project_data.md         # 项目资料
├── images/
│   ├── screenshot1.png
│   └── screenshot2.png
└── documents/
    ├── requirements.docx
    └── design.pdf
```

## 🔧 技术实现

### 后端处理流程
1. **模板识别**: 扫描上传的Word文件，识别封面和正文模板
2. **封面渲染**: 使用docxtpl渲染封面模板
3. **正文渲染**: 使用docxtpl渲染正文模板，然后用python-docx处理结构化内容
4. **文档合并**: 使用docxcompose合并封面和正文
5. **文件清理**: 删除临时文件

### 前端支持
- 支持多文件选择和拖拽上传
- 实时文件预览和删除
- 文件类型自动识别
- 上传进度提示

## 📝 示例模板内容

### 封面模板示例
```
实训报告

姓名：{{name}}
学号：{{student_id}}
班级：{{class_name}}
指导老师：{{instructor}}
项目名称：{{project_name}}

日期：{{date}}
```

### 正文模板示例
```
{{project_name}}

姓名：{{name}}
学号：{{student_id}}
班级：{{class_name}}
指导老师：{{instructor}}

{{report_body}}
```

## ⚠️ 注意事项

1. **字段名称**: 必须使用正确的字段名称，区分大小写
2. **文件格式**: 仅支持 `.docx` 和 `.doc` 格式
3. **编码问题**: 确保模板文件使用UTF-8编码
4. **样式保持**: 合并后的文档会保持原有样式
5. **文件大小**: 建议单个模板文件不超过10MB

## 🐛 故障排除

### 常见问题

1. **模板识别失败**
   - 检查字段名称是否正确
   - 确认文件格式是否为Word文档
   - 查看日志文件了解详细错误

2. **合并失败**
   - 检查docxcompose库是否正确安装
   - 确认模板文件没有损坏
   - 查看临时文件权限

3. **样式丢失**
   - 确保模板文件使用标准Word格式
   - 避免使用复杂的自定义样式
   - 检查字体是否可用

### 调试方法

1. **查看日志**: 检查 `logs/app.log` 文件
2. **测试模板**: 使用提供的示例模板
3. **简化内容**: 先用简单内容测试
4. **检查字段**: 确认所有必需字段都存在

## 📞 技术支持

如遇到问题，请：
1. 查看日志文件
2. 使用示例模板测试
3. 提交Issue并附上错误信息
4. 联系技术支持团队